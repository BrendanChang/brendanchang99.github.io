---
title: "Case Study - How can a wellness company play it smart?"
author: "Chang Jun Cheng"
date: "1/2/2022"
output: html_document
---




## Data background

The data was collected on Kaggle for case study purpose, updated version of the original data sources by the maintainer *Kaggler* MÃ¶bius. Dataset date range from 4.12.2016 to 5.12.2016. 

Below are the original dataset from <https://zenodo.org/>

Furberg, R., Brinton, J., Keating, M., & Ortiz, A. (2016). Crowd-sourced Fitbit datasets 03.12.2016-05.12.2016 [Data set]. Zenodo. https://doi.org/10.5281/zenodo.53894





### Install and load R packages 

Install and load R packages, including `tidyverse`, `janitor`, `reshape` and `lubridate`

```{r install and load R packages}

install.packages("tidyverse")
install.packages("janitor")
install.packages("lubridate")
install.packages("reshape")

library("tidyverse")
library("janitor")
library("lubridate")
library("reshape")

```





### Load CSV files to R 

Upload and load the CSV files that are stored in Big Query

**daily_activity_ver1** is the **original** version with 33 unique respondents

**daily_activity_ver2** is the **updated** version with 28 unique respondents by removing the rows with **sum of different levels of intensity minutes not equal to 1440 (60*24)**

For more information, click here [link](https://docs.google.com/spreadsheets/d/1YsUJBvP4Y285mPF_mBcTmMiZ435MLFQF_Tnt-ikPCeE/edit#gid=0)

```{r upload CSV file}

daily_activity_ver1 <- read.csv("dailyActivity_merged.csv")  
daily_activity_ver2  <- read.csv("daily_data.csv")           
daily_sleep <- read.csv("day_sleep.csv")
hourly_activity  <- read.csv("hourly_data.csv")

```





### Inspecting and exploring the key tables

```{r take a glimpse on daily activity data}

head(daily_activity_ver1)

```

```{r take a glimpse on daily sleep data}

head(daily_sleep)

```

```{r take a glimpse on hour activity data}

head(hourly_activity)

```





### Understanding metadata of the key tables

```{r dive into metadata - daily activity data 1}

str(daily_activity_ver1)

```

```{r dive into metadata - daily activity data 2}

str(daily_activity_ver2)

```

```{r dive into metadata - daily sleep data}

str(daily_sleep)

```

```{r dive into metadata - hour activity data}

str(hourly_activity)

```





### Identify unique respondents for each dataset

```{r unique respondents - daily activity data 1}

n_distinct(daily_activity_ver1$Id)

```

```{r unique respondents - daily activity data 2}

n_distinct(daily_activity_ver2$Id)

```

```{r unique respondents - daily sleep data}

n_distinct(daily_sleep$Id)

```

```{r unique respondents - hourly activity data}

n_distinct(hourly_activity$Id)

```





### Data Cleaning


#### Data cleaning  - clean names for all variables

In this part, do ensure that `janitor` packages is installed and loaded.

```{r clean variables name}

daily_activity_ver1 <- daily_activity_ver1 %>% clean_names()
daily_activity_ver2 <- daily_activity_ver2 %>%  clean_names()
daily_sleep <- daily_sleep %>%  clean_names()
hourly_activity <- hourly_activity %>%  clean_names()

```




#### Data cleaning  - rename all date related variable to date 

Rename the date related variable to date for consistency and later part of analysis.

```{r rename date}

daily_activity_ver1 <- dplyr::rename(daily_activity_ver1, date = activity_date)
daily_activity_ver2 <- dplyr::rename(daily_activity_ver2, date = activity_date)
daily_sleep <-  dplyr::rename(daily_sleep, date = sleep_day)
hourly_activity <-  dplyr::rename(hourly_activity, date = activity_hour)

```




#### Data cleaning  - change all date related variable from chr to date data type 

Change data type for date variable 

```{r change data type}

daily_activity_ver1$date <- as.Date(daily_activity_ver1$date, "%m/%d/%Y")
str(daily_activity_ver1)

```

```{r change data type for the remaining}

daily_activity_ver2$date <- as.Date(daily_activity_ver2$date, "%m/%d/%Y")
daily_sleep$date <- as.Date(daily_sleep$date, "%m/%d/%Y")
hourly_activity$date <- as.POSIXct(hourly_activity$date, format="%Y-%m-%dT%H:%M")
str(hourly_activity)

```





### Identify the maximum and minimum date 

```{r min and max date}

max_date = max(daily_activity_ver2$date)
min_date = min(daily_activity_ver2$date)

```





### Analyze and visualize data (minutes spent on every intensity level in a day)

Deep dive into **daily_activity_ver2** to explore and discover relationship between the variables.
 * discover the average portion of intensity level minutes in a day
 * unpivot the 4 columns (wide format to long format)

install `reshape` packages to `melt` (unpivot the columns)

```{r analyze minutes spent on every intensity level}

daily_activity_ver2_1 <- daily_activity_ver2 %>% 
  select(id, very_active_minutes, fairly_active_minutes, lightly_active_minutes, sedentary_minutes) 
  
melted_daily_activity <- melt(daily_activity_ver2_1, id = c("id"),
                              variable_name = c('intensity_level'))

melted_daily_activity_2 <- melted_daily_activity %>% select(intensity_level, value) %>% 
  group_by(intensity_level) %>% 
  summarize(mean_minutes = mean(value))

```

 * visualize data (observe the weight of each intensity level for a day)
 
```{r visualize minutes spent on every intensity level}
portion_sedentary = round(melted_daily_activity_2$mean_minutes[4]/1440*100,2)

p1 <- melted_daily_activity_2 %>% ggplot(mapping = aes(x=intensity_level, y=mean_minutes, fill=intensity_level))+geom_col()
  
p1 + labs(title = "Minutes spent on every intensity level in a day", x = "intensity level", y = "average minutes", 
          caption=paste0("data collected from ", min_date, " to ",  max_date))+
  theme(axis.text.x = element_text(angle = 25) )+
  annotate(geom = "text", x = "sedentary_minutes", y = 800, label =paste0(portion_sedentary, "%"))

```
Conclusion: On average, respondent spent **85.83%** of a day in sedentary behavior.





### Analyze and visualize data 2 (relationship between total steps, average intensities and calories)

Total Steps Taken vs Average intensity

```{r analyze & visualize Total Steps Taken vs Average intensity}

corr1 <- round(cor(hourly_activity$average_intensity, hourly_activity$total_steps),4)

p2 <- hourly_activity %>%  ggplot(aes(x=average_intensity, y=total_steps))+
  geom_point()+geom_smooth()


p2 + labs(title = "Total Steps Taken vs Average intensity", x = "Average intensity", y = "Total Steps Taken", 
          caption=paste0("data collected from ", min_date, " to ",  max_date))+
  annotate(geom = "text", x = 1.5, y = 7500, label =paste0("correlation, r: ", corr1), color = "red")

```

**Conclusion: the higher the intensity, the more steps taken in a day.**


Calories burned vs Average intensity

```{r analyze & visualize Calories burned vs Average intensity}

corr2 <- round(cor(hourly_activity$average_intensity, hourly_activity$calories),4)

p3 <- hourly_activity %>%  ggplot(aes(x=average_intensity, y=calories))+
  geom_point()+geom_smooth()


p3 + labs(title = "Calories burned vs Average intensity", x = "Average intensity", y = "Calories burned", 
          caption=paste0("data collected from ", min_date, " to ",  max_date))+
  annotate(geom = "text", x = 1.5, y = 750, label =paste0("correlation, r: ", corr2), color = "red")

```

**Conclusion: the higher the intensity, the more calories burned in a day.**


Calories burned vs Total steps taken

```{r analyze & visualize Calories burned vs Total steps taken}

corr3 <- round(cor(hourly_activity$total_steps, hourly_activity$calories),4)

p4 <- hourly_activity %>%  ggplot(aes(x=total_steps, y=calories))+
  geom_point()+geom_smooth()


p4 + labs(title = "Calories burned vs Total steps taken", x = "Total steps taken", y = "Calories burned", 
          caption=paste0("data collected from ", min_date, " to ",  max_date))+
  annotate(geom = "text", x = 5000, y = 750, label =paste0("correlation, r: ", corr3), color = "red")

```

**Conclusion: the more steps taken, the more calories burned in a day.**


Calories burned vs Total distance

```{r analyze & visualize Calories burned vs Total distance}

corr4 <- round(cor(daily_activity_ver2$total_distance,daily_activity_ver2$calories),4)

p5 <- daily_activity_ver2 %>% ggplot(aes(x=total_distance, y=calories))+geom_point()+geom_smooth()

p5 + labs(title = "Calories burned vs Total distance", x = "Total distance", y = "Calories burned", 
          caption=paste0("data collected from ", min_date, " to ",  max_date))+
  annotate(geom = "text", x = 10, y = 4500, label =paste0("correlation, r: ", corr4), color = "red")

```
**Conclusion: the more distance go for a day, the more calories burned in a day.**


## Findings 1

**Findings: With high intensity, high total steps taken and more distance taken, more calories will be burned as well**





### Analyze and visualize data 3 (explore relationship between intensity, total distance and sleep)

 * `inner_join` the daily sleep table and daily activity ver 1
 
Total distance vs Sedentary minutes

```{r analyze & visualize Total distance vs Sedentary minutes}

corr5 <- round(cor(daily_activity_ver2$total_distance,daily_activity_ver2$sedentary_minutes),4)

p6 <- daily_activity_ver2 %>% ggplot(aes(x=sedentary_minutes, y=total_distance))+geom_point()+geom_smooth()

p6 + labs(title = "Total distance vs Sedentary minutes", x = "Sedentary minutes", y = "Total distance", 
          caption=paste0("data collected from ", min_date, " to ",  max_date))+
  annotate(geom = "text", x = 1250, y = 25, label =paste0("correlation, r: ", corr5), color = "red")

```
**Conclusion: the lesser minutes spent on sedentary behavior, the more the distance taken.**



Sedentary minutes vs Total minutes asleep

```{r inner join data}

combined_data <-inner_join(daily_sleep, daily_activity_ver1, by=c("id", "date"))

```

```{r analyze & visualize Sedentary minutes vs Total minutes asleep}

corr6<- round(cor(combined_data$total_minutes_asleep,combined_data$sedentary_minutes),4)

p7 <- combined_data %>% ggplot(aes(x=total_minutes_asleep,y=sedentary_minutes))+geom_point()+geom_smooth()

p7 + labs(title = "Sedentary minutes vs Total minutes asleep", x = "Total minutes asleep", y = "Sedentary minutes", 
          caption=paste0("data collected from ", min_date, " to ",  max_date))+
  annotate(geom = "text", x = 500, y = 1200, label =paste0("correlation, r: ", corr6), color = "red")

```

**Conclusions: The more minutes a people fall asleep, the lesser minutes spent on sedentary behavior**


## Findings 2

**Findings: With more minutes a people fall asleep, the person will spend less minutes on sedentary behavior and take more distance.**





### Analyze and visualize data 4 (explore sleeping habits)

```{r analyze & visualize Total minutes asleep vs Total time in bed}

corr7 <- round(cor(daily_sleep$total_time_in_bed, daily_sleep$total_minutes_asleep),4)

p8 <- daily_sleep %>% ggplot(aes(x=total_time_in_bed, y=total_minutes_asleep))+geom_point()+geom_smooth()

p8 + labs(title = "Total minutes asleep vs Total time in bed", x = "Total time in bed", y = "Total minutes asleep", 
          caption=paste0("data collected from ", min_date, " to ",  max_date))+
  annotate(geom = "text", x = 500, y = 760, label =paste0("correlation: ", corr5), color = "red")

```

**Findings: the more time on bed, the more minutes fall asleep.**




### Summary of findings:
 * **With more time on bed, people will fall asleep for more minutes. With good quality sleeping, the person will spend less minutes on sedentary behavior and take more distance.**
 * **With high intensity, high total steps taken and more distance taken, more calories will be burned as well**
 

### High-level recommendation:
 * **Add in new features to current smart device to track user's sleeping habits.**
 * **Design a dashboard specifying the impact of good quality sleeping, eg. how it affects your daily life using data.**



### Next Analysis:
 * **Identify more on user's sleeping habits.**
 * **Determine the 3 most important factors for a good quality sleeping.**




